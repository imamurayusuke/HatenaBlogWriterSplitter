# HatenaBlogWriterSplitter(v0.1.0)

## 概要
これは「はてダラスプリッタ」を「はてなブログライター」で使えるようにforkしたものです。

### リンク
- はてダラスプリッタ（はてなダイアリーライタースプリッタ）…http://www.hyuki.com/techinfo/hatena_diary_writer.html#hws
- はてなブログライター…https://github.com/rnanba/HatenaBlogWriter

## 必要なもの
- Perl

## 使い方
``diary.txt``に、はてなブログにアップロードしたい内容を書きます。**``diary.txt``は文字コードをUTF-8にして保存してください。**

``diary.txt``と``hbws.pl``を同じディレクトリに置き、``perl hbws.pl``を実行すると、はてなブログライター向けの日付＋連番に分割されたテキストファイルが出力されます。``hbws.pl``の実行によって``diary.txt``の内容が変化することはありません。

## ``diary.txt``の書式

``diary.txt``はたとえば以下のように書いてください。

```
2019-01-01_01:1つめのタイトル
date: 2019-01-01 12:00:00 +0900
category: test
draft: no
本文

2019-01-01_02:2つめのタイトル
date: 2019-01-01 12:00:00 +0900
category: test
draft: no
本文

2019-01-02_01:3つめのタイトル
date: 2019-01-02 12:00:00 +0900
category: test
draft: no
本文
```

上のような``diary.txt``を用意して``hbws.pl``を実行すると、``2019-01-01_01.txt``、``2019-01-01_02.txt``、``2019-01-02_01.txt``が作られます。内容の例として、``2019-01-01_01.txt``は以下のようになります。

```
title: 1つめのタイトル
date: 2019-01-01 12:00:00 +0900
category: test
draft: no
本文

```

## 仕様や制限について

``diary.txt``内の「日付_連番:タイトル」という行から次の「日付_連番:タイトル」までが、はてなブログの1エントリファイルになります。

「日付_連番:タイトル」に書かれた日付と``date:``に書かれた日付が異なる場合、エントリの日付やURL、エントリの投稿日時（エントリ末尾の「×日前」などの算出に使われる）は``date:``の日時が使われます（これははてなブログライターの仕様に従います。左の説明はv0.8.1の仕様に基づきます）。``日付_連番``と``date:``は同じにしておくのが好ましいと思いますが、過去のエントリ（``date:``）をいつ書いたか（``日付_連番``）を記録しておくといった使い方もあります。

``diary.txt``内に「日付_連番」が同じものがあった場合、``ERROR: Duplicate yyyy-mm-dd_nn. (エントリのタイトル)``というメッセージが出ますが、Windowsのコマンドプロンプトではエントリのタイトルが文字化けします。これはエントリのタイトルの文字コードがUTF-8であるのに対し、コマンドプロンプトの文字コードがShift_JIS（のcp932）であるためです。

エントリのタイトルに``delete``を書いてエントリを削除する仕様は実装されておらず、「detete」というタイトルのエントリが投稿されます。エントリを削除したい場合は、``draft: no``の下あたりに``delete: yes``と書いて``hbws.pl``を実行した上で、はてなブログライターを実行してください。（``delete: yes``と書いてエントリを削除するのははてなブログライターの機能です。この機能について詳しくは https://github.com/rnanba/HatenaBlogWriter/blob/master/README.md#%E5%89%8A%E9%99%A4 を参照してください）

## 今までにはてなブログライターで登録したエントリを``diary.txt``に追加する方法

下はWindowsのコマンドプロンプトを使う手順ですが、ほかのOSでもおおむね同じ方法でできると思います。

1. はてなブログライターのあるディレクトリに``add_blog_header.pl``を置く
1. コマンドプロンプトを開き、はてなブログライターのあるディレクトリで``dir /b ????-??-??_??.txt > dir.bat``を実行
1. テキストエディタで``dir.bat``を開き、行頭に``perl add_blog_date_header.pl ``を追加（正規表現置換が使えるテキストエディタならば、``^(.)``を``perl add_blog_date_header.pl $1``に置換）。その結果、たとえば``2019-01-01_01.txt``が``perl add_blog_date_header.pl 2019-01-01_01.txt``になればよい
1. ``dir.bat``を実行。その結果、たとえば``2019-01-01_01.txt``から``a2019-01-01_01.txt``が作られればよい
1. ``copy /b a*.txt diary_old.txt``を実行。手順4で作られたテキストファイルが連結される
1. ``diary.txt``の冒頭に``diary_old.txt``の内容をコピー

## 履歴
- 2019-01-03(v0.1.0): 公開
